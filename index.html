<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>merry christmas my bby</title>

  <link rel="icon" type="image/png" href="secret%20box.png">
  <link rel="apple-touch-icon" href="secret%20box.png">
  <meta name="apple-mobile-web-app-title" content="merry christmas my bby">

  <style>
    :root{
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);

      --pad-x: clamp(14px, 3vw, 28px);

      /* LANDING */
      --xmas-max-h: clamp(320px, 56svh, 720px);
      --click-h: clamp(110px, 18svh, 210px);
      --landing-gap: clamp(10px, 2.2vh, 18px);

      /* GIFTS */
      --gift-box-w: clamp(140px, 16vw, 210px);
      --open-btn-w: clamp(120px, 13vw, 175px);

      --counter-w: clamp(80px, 8vw, 120px);
      --back-w: clamp(260px, 22vw, 520px);

      /* header */
      --header-w: min(2600px, 98vw);
      --header-max-h: clamp(160px, 26svh, 360px);

      /* footer */
      --footer-pad: clamp(10px, 2.2vw, 22px);
      --secret-footer-w: clamp(420px, 52vw, 860px);

      /* MODAL */
      --close-w: clamp(170px, 20vw, 260px);
      --note-scale: 1.35;

      /* à¸›à¸¸à¹ˆà¸¡à¸¥à¹ˆà¸²à¸‡ modal */
      --modal-btn-open-w: min(720px, 92vw);
      --modal-btn-okay-w: min(520px, 70vw);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }
    body{
      background:#000;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      overflow:hidden;
    }

    .stage{
      position:fixed;
      inset:0;
      width:100vw;

      /* à¹ƒà¸Šà¹‰ dvh à¸à¹ˆà¸­à¸™ à¹à¸¥à¹‰à¸§ fallback à¹€à¸›à¹‡à¸™ vh */
      height:100dvh;
      height:100vh;

      background:#fff;
      overflow:hidden;
      isolation:isolate;
    }

    .bg{
      position:absolute; inset:0;
      background: url("landing-bg.png") center/cover no-repeat;
      pointer-events:none;
      z-index:0;
    }

    /* FX */
    .fx{
      position:absolute; inset:0;
      pointer-events:none;
      z-index:1;
      overflow:hidden;
    }
    .snowflake{
      position:absolute;
      top:-12vh;
      width: 8px; height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.95);
      opacity:.75;
      filter: blur(.15px);
      animation: snowFall linear infinite;
      will-change: transform;
    }
    @keyframes snowFall{
      0%   { transform: translate3d(var(--x,0px), -12vh, 0) scale(var(--s,1)); }
      100% { transform: translate3d(calc(var(--x,0px) + var(--drift,0px)), 112vh, 0) scale(var(--s,1)); }
    }

    img{ max-width:100%; height:auto; display:block; }

    .imgbtn{
      border:0; padding:0; margin:0;
      background:transparent;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      outline:none;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      position:relative;
      transform: translateZ(0);
    }
    .imgbtn > img{
      width:100%;
      height:100%;
      object-fit:contain;
      pointer-events:none;
      display:block;
    }

    .hovGrow{ transition: transform .16s ease; will-change: transform; }
    @media (hover:hover){ .hovGrow:hover{ transform: scale(1.06); } }
    .hovGrow:active{ transform: scale(.99); }

    @keyframes floatA{
      0%{ transform: translateY(0) rotate(var(--tilt,0deg)); }
      50%{ transform: translateY(-14px) rotate(calc(var(--tilt,0deg) + .6deg)); }
      100%{ transform: translateY(0) rotate(var(--tilt,0deg)); }
    }
    @keyframes floatB{
      0%{ transform: translateY(0); }
      50%{ transform: translateY(-10px); }
      100%{ transform: translateY(0); }
    }

    .screen{
      position:absolute;
      inset:0;
      z-index:2;
      padding:
        calc(var(--safe-top) + 10px)
        calc(var(--pad-x) + var(--safe-right))
        calc(var(--safe-bottom) + 10px)
        calc(var(--pad-x) + var(--safe-left));
      min-height:0;
    }
    .hidden{ display:none !important; }

    /* LANDING */
    #screenLanding{
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .landingWrap{
      width:100%;
      max-width: 1300px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap: var(--landing-gap);
      padding-top: calc(var(--safe-top) + 8px);
      padding-bottom: calc(var(--safe-bottom) + 8px);
    }

    #landingXmas{
      width: min(1100px, 92vw);
      max-height: var(--xmas-max-h);
      object-fit:contain;
      pointer-events:none;
    }

    #btnStart{
      height: var(--click-h);
      width: auto;
      aspect-ratio: 420 / 210;
      max-width: min(760px, 90vw);
      z-index: 4;
    }
    #btnStart::before{
      content:"";
      position:absolute;
      inset:-16px;
      border-radius: 22px;
    }

    #landingSnowman{
      position:absolute;
      right: calc(10px + var(--safe-right));
      bottom: calc(10px + var(--safe-bottom));
      width: clamp(190px, 18vw, 320px);
      z-index: 4;
      pointer-events:none;
      animation: floatB 3.2s ease-in-out infinite;
    }

    #landingLogo{ display:none; }

    /* GIFTS */
    #screenGifts{
      padding-top: calc(var(--safe-top) + 6px);
      padding-bottom: 0;
      display:grid;
      grid-template-rows: auto 1fr auto;
      min-height:0;
    }

    #headerArt{
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding: 0;
      margin: 0;
    }

    #headerArt img{
      width: var(--header-w);
      max-height: var(--header-max-h);
      height:auto;
      object-fit:contain;
      pointer-events:none;
    }

    #giftZone{
      display:flex;
      justify-content:center;
      align-items:center;
      min-height:0;
      z-index:2;
      padding: clamp(10px, 2vh, 22px) 0;
      overflow:visible;
    }

    #giftGrid{
      display:grid;
      grid-template-columns: repeat(4, var(--gift-box-w));
      justify-content:center;
      align-items:start;
      column-gap: clamp(18px, 3.6vw, 60px);
      row-gap: clamp(16px, 2.8vw, 28px);
      max-width: 100%;
      transform:none;
    }

    .giftItem{
      width: var(--gift-box-w);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 14px;
      transform: translate(var(--dx,0px), var(--dy,0px)) rotate(var(--rot,0deg));
      transform-origin:center;
      position:relative;
      z-index:3;
    }

    .giftBoxWrap{
      width:100%;
      aspect-ratio:1/1;
      animation: floatA 4.0s ease-in-out infinite;
      animation-delay: var(--fd, 0s);
      --tilt: var(--tilt, 0deg);
      will-change: transform;
      filter: drop-shadow(0 12px 26px rgba(0,0,0,.14));
      z-index:3;
    }
    .giftBoxBtn{ width:100%; height:100%; transition: transform .16s ease; z-index:3; }
    @media (hover:hover){
      .giftItem:hover .giftBoxBtn{
        transform: rotate(3deg) translateY(-2px) scale(1.02);
      }
    }

    .openBtn{
      width: var(--open-btn-w);
      aspect-ratio: 200 / 92;
      animation: floatB 2.7s ease-in-out infinite;
      animation-delay: var(--od, 0s);
      z-index: 30;
      position:relative;
      pointer-events:auto;
    }
    .openBtn::before{
      content:"";
      position:absolute;
      inset:-24px;
      border-radius: 24px;
    }

    #footerRow{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      grid-template-areas: "back mid .";
      align-items:end;
      padding: 0 0 calc(var(--footer-pad) + var(--safe-bottom)) 0;
      gap: 10px;
      z-index: 10;
    }

    #btnBack{
      grid-area: back;
      justify-self:start;
      width: min(var(--back-w), 92vw);
      aspect-ratio: 200 / 92;
      z-index: 12;
    }

    #openedCounter{
      grid-area: mid;
      justify-self:center;
      width: min(var(--counter-w), 40vw);
      pointer-events:none;
      z-index: 11;
    }
    #openedCounter img{ width:100%; height:auto; }

    #btnOpenSecretFooter{
      grid-area: mid;
      justify-self:center;
      width: min(var(--secret-footer-w), 92vw);
      aspect-ratio: 430 / 150;
      display:none;
      z-index: 12;
    }

    /* tablet-ish */
    @media (max-width: 1180px){
      #giftGrid{ grid-template-columns: repeat(2, var(--gift-box-w)); }
    }

    @media (max-width: 900px){
      :root{
        --gift-box-w: clamp(150px, 40vw, 230px);
        --open-btn-w: clamp(120px, 34vw, 185px);
        --counter-w: clamp(74px, 18vw, 120px);
        --back-w: clamp(260px, 78vw, 520px);
        --secret-footer-w: clamp(360px, 92vw, 820px);
        --header-max-h: clamp(140px, 30svh, 340px);
      }

      #footerRow{
        grid-template-columns: 1fr;
        grid-template-areas:
          "mid"
          "back";
        justify-items:center;
        gap: 10px;
      }
      #btnBack{ justify-self:center; }
    }

    /* MODAL */
    .modalOverlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
      padding:
        calc(12px + var(--safe-top))
        calc(12px + var(--safe-right))
        calc(12px + var(--safe-bottom))
        calc(12px + var(--safe-left));
    }
    .modalOverlay.show{ display:flex; }

    .modalCard{
      position:relative;
      width:min(1200px, 96vw);
      height:min(92svh, 920px);
      display:grid;
      grid-template-rows: 1fr auto;
      overflow:hidden;
      transform: translateY(18px) scale(.96);
      opacity:0;
    }
    .modalOverlay.show .modalCard{
      animation: modalPop .42s cubic-bezier(.2,.9,.2,1) both;
    }
    @keyframes modalPop{
      0%   { transform: translateY(18px) scale(.96); opacity: 0; }
      60%  { transform: translateY(-2px) scale(1.01); opacity: 1; }
      100% { transform: translateY(0) scale(1); opacity: 1; }
    }

    .modalBody{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: clamp(10px, 2vh, 18px);
      overflow:hidden;
    }

    #artWrap{
      position:relative;
      width:min(980px, 94vw);
      height:min(78svh, 820px);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    #modalArt{
      width:100%;
      height:100%;
      object-fit:contain;
      pointer-events:none;
      display:block;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.35));
      transform-origin:center;
    }

    .modalOverlay[data-mode="giftNote"] #modalArt{
      transform: scale(var(--note-scale));
    }

    .modalFooter{
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding: 12px 12px calc(10px + var(--safe-bottom));
      gap: 12px;
      min-height: clamp(74px, 12svh, 130px);
      flex-wrap: wrap;
    }

    .modalActionBtn{
      display:none;
      width: var(--modal-btn-open-w);
      aspect-ratio: 430 / 150;
    }
    .modalActionBtn::before{
      content:"";
      position:absolute;
      inset:-18px;
      border-radius: 30px;
    }

    /* à¸—à¸³à¹ƒà¸«à¹‰ okay à¹€à¸—à¹ˆà¸²à¸›à¸¸à¹ˆà¸¡ close à¸šà¸™ desktop */
    #btnOkayInModal{
      width: min(var(--close-w), 92vw);
      aspect-ratio: 190 / 90;
    }

    #btnCloseModal{
      width: min(var(--close-w), 92vw);
      aspect-ratio: 190 / 90;
      display:none;
    }
    #btnCloseModal::before{
      content:"";
      position:absolute;
      inset:-18px;
      border-radius: 30px;
    }

    #assetWarning{
      position:fixed;
      left: 16px; top: 16px;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(0,0,0,.55);
      color:#fff;
      font-size: 13px;
      z-index: 999;
      display:none;
      max-width: min(560px, 92vw);
      line-height: 1.35;
      pointer-events:none;
      white-space: pre-wrap;
    }

    /* ðŸ“± Mobile tweaks: <= 600px */
    @media (max-width: 600px){

      .stage{
        overflow-y:auto; /* à¸–à¹‰à¸²à¸‚à¸­à¸‡à¸ªà¸¹à¸‡à¹€à¸à¸´à¸™ à¹ƒà¸«à¹‰à¹€à¸¥à¸·à¹ˆà¸­à¸™à¹ƒà¸™ stage à¹„à¸”à¹‰ */
      }

      .screen{
        padding:
          calc(var(--safe-top) + 8px)
          calc(10px + var(--safe-right))
          calc(var(--safe-bottom) + 8px)
          calc(10px + var(--safe-left));
      }

      /* landing: à¸£à¸¹à¸› + à¸›à¸¸à¹ˆà¸¡à¹€à¸•à¹‡à¸¡à¸ˆà¸­à¹à¸šà¸šà¸à¸”à¸‡à¹ˆà¸²à¸¢ */
      #landingXmas{
        width: 96vw;
        max-height: 50svh;
      }

      #btnStart{
        max-width: 82vw;
        height: auto;
        aspect-ratio: 420 / 210;
      }

      #landingSnowman{
        width: 26vw;
        right: calc(6px + var(--safe-right));
        bottom: calc(6px + var(--safe-bottom));
      }

      /* gifts: 1 à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ à¸à¸”à¸‡à¹ˆà¸²à¸¢à¸‚à¸¶à¹‰à¸™ */
      #screenGifts{
        grid-template-rows: auto 1fr auto;
        row-gap: 6px;
      }

      #giftZone{
        align-items:flex-start;
        padding-top: 6px;
      }

      #giftGrid{
        grid-template-columns: 1fr; /* à¸ˆà¸²à¸ 4/2 à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ â†’ 1 à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ */
        row-gap: 18px;
      }

      .giftItem{
        width: 82vw;
      }

      .giftBoxWrap{
        max-width: 82vw;
      }

      .openBtn{
        width: 72vw;
      }

      /* footer: counter à¸šà¸™ / back à¸¥à¹ˆà¸²à¸‡ */
      #footerRow{
        grid-template-columns: 1fr;
        grid-template-areas:
          "mid"
          "back";
        justify-items:center;
        gap: 10px;
      }
      #btnBack{
        justify-self:center;
      }

      /* modal: à¹ƒà¸Šà¹‰à¹€à¸•à¹‡à¸¡à¸ˆà¸­ à¸›à¸¸à¹ˆà¸¡à¹ƒà¸«à¸à¹ˆà¹€à¸•à¹‡à¸¡à¸™à¸´à¹‰à¸§ */
      .modalCard{
        width: 100%;
        height: auto;
        max-height: 92svh;
      }

      #artWrap{
        width: 100%;
        height: auto;
        max-height: 70svh;
      }

      .modalFooter{
        gap: 8px;
      }

      .modalActionBtn,
      #btnCloseModal{
        width: 92vw;
      }

      #btnOkayInModal{
        width: 80vw;
      }
    }
  </style>
</head>

<body>
  <div id="assetWarning"></div>

  <div class="stage" id="stage">
    <div class="bg"></div>
    <div class="fx" id="fx"></div>

    <!-- LANDING -->
    <div class="screen" id="screenLanding">
      <div class="landingWrap">
        <img id="landingXmas" alt="xmas" />
        <button class="imgbtn hovGrow" id="btnStart" type="button" aria-label="Start">
          <img alt="Click here" id="imgClickHere" />
        </button>
      </div>
      <img id="landingLogo" alt="logo" />
      <img id="landingSnowman" alt="snowman" />
    </div>

    <!-- GIFTS -->
    <div class="screen hidden" id="screenGifts">
      <div id="headerArt"><img alt="Gifts for Kim" id="imgHeader" /></div>

      <div id="giftZone">
        <div id="giftGrid">
          <div class="giftItem" style="--dx:-10px;--dy:-4px;--rot:-1deg;--tilt:-10deg;--fd:-.6s;--od:-.2s;">
            <div class="giftBoxWrap">
              <button class="imgbtn giftBoxBtn" data-action="open" data-color="green" type="button">
                <img alt="Green gift" id="imgGiftGreen" />
              </button>
            </div>
            <button class="imgbtn openBtn hovGrow" data-action="open" data-color="green" type="button">
              <img alt="Open green" id="imgOpenGreen" />
            </button>
          </div>

          <div class="giftItem" style="--dx:8px;--dy:6px;--rot:1deg;--tilt:7deg;--fd:-1.2s;--od:-.6s;">
            <div class="giftBoxWrap" style="animation-duration:4.4s;">
              <button class="imgbtn giftBoxBtn" data-action="open" data-color="red" type="button">
                <img alt="Red gift" id="imgGiftRed" />
              </button>
            </div>
            <button class="imgbtn openBtn hovGrow" data-action="open" data-color="red" type="button">
              <img alt="Open red" id="imgOpenRed" />
            </button>
          </div>

          <div class="giftItem" style="--dx:-6px;--dy:10px;--rot:.8deg;--tilt:-5deg;--fd:-.9s;--od:-.1s;">
            <div class="giftBoxWrap" style="animation-duration:4.1s;">
              <button class="imgbtn giftBoxBtn" data-action="open" data-color="pink" type="button">
                <img alt="Pink gift" id="imgGiftPink" />
              </button>
            </div>
            <button class="imgbtn openBtn hovGrow" data-action="open" data-color="pink" type="button">
              <img alt="Open pink" id="imgOpenPink" />
            </button>
          </div>

          <div class="giftItem" style="--dx:12px;--dy:-6px;--rot:-.7deg;--tilt:10deg;--fd:-1.5s;--od:-.4s;">
            <div class="giftBoxWrap" style="animation-duration:4.6s;">
              <button class="imgbtn giftBoxBtn" data-action="open" data-color="orange" type="button">
                <img alt="Orange gift" id="imgGiftOrange" />
              </button>
            </div>
            <button class="imgbtn openBtn hovGrow" data-action="open" data-color="orange" type="button">
              <img alt="Open orange" id="imgOpenOrange" />
            </button>
          </div>
        </div>
      </div>

      <div id="footerRow">
        <button class="imgbtn hovGrow" id="btnBack" type="button" aria-label="Back">
          <img alt="Back" id="imgBack" />
        </button>

        <div id="openedCounter">
          <img alt="Opened counter" id="imgCounter" />
        </div>

        <button class="imgbtn hovGrow" id="btnOpenSecretFooter" type="button" aria-label="Open secret box">
          <img alt="Open secret box" id="imgOpenSecretFooter" />
        </button>
      </div>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modalOverlay" id="modal" role="dialog" aria-modal="true">
    <div class="modalCard" id="modalCard">
      <div class="modalBody">
        <div id="artWrap">
          <img alt="Modal content" id="modalArt" />
        </div>
      </div>

      <div class="modalFooter" id="modalFooter">
        <button class="imgbtn hovGrow modalActionBtn" id="btnOpenSecretInModal" type="button" aria-label="Open secret box">
          <img alt="Open secret box" id="imgOpenSecretInModal" />
        </button>

        <button class="imgbtn hovGrow modalActionBtn" id="btnOkayInModal" type="button" aria-label="Okay">
          <img alt="Okay" id="imgOkay" />
        </button>

        <button class="imgbtn hovGrow" id="btnCloseModal" type="button" aria-label="Close">
          <img alt="Close" id="imgClose" />
        </button>
      </div>
    </div>
  </div>

  <script>
    const url = (name) => encodeURI(name);

    const ASSETS = {
      clickHere: "click here.png",
      xmas: "xmas.png",
      landingLogo: "merry christmas kim.png",
      snowman: "snowman.png",

      header: "gift for kim.png",

      gifts: {
        green: "green gift.png",
        red: "red gift.png",
        pink: "pink gift.png",
        orange: "orange gift.png",
      },
      openBtns: {
        green: "green open.png",
        red: "red open.png",
        pink: "pink open.png",
        orange: "orange open.png",
      },
      notes: {
        green: "green note.png",
        red: "red note.png",
        pink: "pink note.png",
        orange: "orange note.png",
      },

      counter: { 0:"04.png", 1:"14.png", 2:"24.png", 3:"34.png", 4:"44.png" },

      back: "back.png",
      close: "close.png",

      secretIntro: "secret note.png",
      secretFinal: "secret note 2.png",
      openSecret: "open secret box.png",
      okay: "okay.png",
    };

    const assetWarning = document.getElementById("assetWarning");
    const fx = document.getElementById("fx");

    function setImg(imgEl, filename, silent=false){
      imgEl.src = url(filename);
      imgEl.onerror = () => {
        if(silent){ imgEl.style.display = "none"; return; }
        assetWarning.style.display = "block";
        assetWarning.textContent =
          "à¸£à¸¹à¸›à¹‚à¸«à¸¥à¸”à¹„à¸¡à¹ˆà¸‚à¸¶à¹‰à¸™ (à¹€à¸Šà¹‡à¸„à¸Šà¸·à¹ˆà¸­à¹„à¸Ÿà¸¥à¹Œ/à¹€à¸§à¹‰à¸™à¸§à¸£à¸£à¸„/à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œà¹ƒà¸«à¹‰à¸•à¸£à¸‡)\nMissing: " + filename;
      };
    }

    /* FX */
    function makeSnow(count=44){
      for(let i=0;i<count;i++){
        const f = document.createElement("div");
        f.className = "snowflake";
        const left = Math.random()*100;
        const size = 4 + Math.random()*9;
        const dur  = 5.8 + Math.random()*6.8;
        const delay= -Math.random()*dur;
        const drift= (Math.random()*2-1) * 46;
        const op   = 0.18 + Math.random()*0.55;
        const x    = (Math.random()*2-1) * 24;

        f.style.left = left + "vw";
        f.style.width = size + "px";
        f.style.height= size + "px";
        f.style.opacity = op;
        f.style.setProperty("--s", (0.75 + Math.random()*0.75).toFixed(2));
        f.style.setProperty("--drift", drift.toFixed(0) + "px");
        f.style.setProperty("--x", x.toFixed(0) + "px");
        f.style.animationDuration = dur.toFixed(2) + "s";
        f.style.animationDelay = delay.toFixed(2) + "s";
        fx.appendChild(f);
      }
    }
    makeSnow();

    /* elements */
    const screenLanding = document.getElementById("screenLanding");
    const screenGifts   = document.getElementById("screenGifts");
    const btnStart      = document.getElementById("btnStart");
    const btnBack       = document.getElementById("btnBack");

    const imgClickHere  = document.getElementById("imgClickHere");
    const landingXmas   = document.getElementById("landingXmas");
    const landingSnowman= document.getElementById("landingSnowman");

    const imgHeader     = document.getElementById("imgHeader");
    const imgGiftGreen  = document.getElementById("imgGiftGreen");
    const imgGiftRed    = document.getElementById("imgGiftRed");
    const imgGiftPink   = document.getElementById("imgGiftPink");
    const imgGiftOrange = document.getElementById("imgGiftOrange");

    const imgOpenGreen  = document.getElementById("imgOpenGreen");
    const imgOpenRed    = document.getElementById("imgOpenRed");
    const imgOpenPink   = document.getElementById("imgOpenPink");
    const imgOpenOrange = document.getElementById("imgOpenOrange");

    const imgBack       = document.getElementById("imgBack");
    const imgCounter    = document.getElementById("imgCounter");

    const modal         = document.getElementById("modal");
    const modalArt      = document.getElementById("modalArt");

    const btnCloseModal = document.getElementById("btnCloseModal");
    const imgClose      = document.getElementById("imgClose");

    const btnOpenSecretInModal = document.getElementById("btnOpenSecretInModal");
    const imgOpenSecretInModal = document.getElementById("imgOpenSecretInModal");

    const btnOkayInModal = document.getElementById("btnOkayInModal");
    const imgOkay        = document.getElementById("imgOkay");

    const btnOpenSecretFooter = document.getElementById("btnOpenSecretFooter");
    const imgOpenSecretFooter = document.getElementById("imgOpenSecretFooter");

    /* state */
    const opened = new Set();
    let pendingSecretAfterClose = false;
    let secretState = 0; // 0 locked, 1 intro shown, 2 acknowledged

    function render(){
      const n = Math.min(opened.size, 4);
      const showCounter = (n < 4) && (secretState < 2);

      document.getElementById("openedCounter").style.display = showCounter ? "block" : "none";
      if(showCounter) setImg(imgCounter, ASSETS.counter[n], true);

      btnOpenSecretFooter.style.display = (secretState >= 2) ? "flex" : "none";

      ["green","red","pink","orange"].forEach(color=>{
        const isOpened = opened.has(color);
        document.querySelectorAll(`[data-color="${color}"]`).forEach(btn=>{
          btn.style.opacity = isOpened ? "0.85" : "1";
          btn.style.filter  = isOpened ? "grayscale(22%)" : "none";
        });
      });
    }

    function resetModalUI(){
      btnCloseModal.style.display = "none";
      btnOpenSecretInModal.style.display = "none";
      btnOkayInModal.style.display = "none";
    }

    function openModal(mode, filename){
      modal.dataset.mode = mode;
      resetModalUI();

      setImg(modalArt, filename, false);
      modal.classList.add("show");

      if(mode === "giftNote"){
        btnCloseModal.style.display = "flex";
        return;
      }

      if(mode === "secretIntro"){
        btnOpenSecretInModal.style.display = "flex";
        return;
      }

      if(mode === "secretFinal"){
        btnOkayInModal.style.display = "flex";
        return;
      }
    }

    function closeModal(force=false){
      modal.classList.remove("show");
      modal.dataset.mode = "";
      resetModalUI();

      if(!force && pendingSecretAfterClose){
        pendingSecretAfterClose = false;
        secretState = Math.max(secretState, 1);
        setTimeout(()=> openModal("secretIntro", ASSETS.secretIntro), 220);
      }
    }

    function showLanding(){
      closeModal(true);
      screenLanding.classList.remove("hidden");
      screenGifts.classList.add("hidden");
      render();
    }

    function showGifts(){
      closeModal(true);
      screenLanding.classList.add("hidden");
      screenGifts.classList.remove("hidden");
      render();
    }

    function openGift(color){
      if(!opened.has(color)) opened.add(color);
      openModal("giftNote", ASSETS.notes[color]);
      render();

      if(opened.size >= 4 && secretState === 0){
        pendingSecretAfterClose = true;
      }
    }

    /* OPEN gifts */
    document.addEventListener("pointerup", (e)=>{
      const btn = e.target.closest("[data-action]");
      if(!btn) return;
      e.preventDefault();
      e.stopPropagation();
      openGift(btn.dataset.color);
    }, { capture:true });

    btnCloseModal.addEventListener("pointerup", (e)=>{
      e.preventDefault();
      closeModal(false);
    }, {capture:true});

    btnOpenSecretInModal.addEventListener("pointerup", (e)=>{
      e.preventDefault();
      openModal("secretFinal", ASSETS.secretFinal);
    }, {capture:true});

    btnOkayInModal.addEventListener("pointerup", (e)=>{
      e.preventDefault();
      secretState = 2;
      closeModal(true);
      render();
    }, {capture:true});

    btnOpenSecretFooter.addEventListener("pointerup", (e)=>{
      e.preventDefault();
      openModal("secretFinal", ASSETS.secretFinal);
    }, {capture:true});

    btnStart.addEventListener("pointerup", (e)=>{
      e.preventDefault();
      showGifts();
    }, {capture:true});

    btnBack.addEventListener("pointerup", (e)=>{
      e.preventDefault();
      showLanding();
    }, {capture:true});

    /* init images */
    setImg(imgClickHere, ASSETS.clickHere);
    setImg(landingXmas, ASSETS.xmas);
    setImg(landingSnowman, ASSETS.snowman);

    setImg(imgHeader, ASSETS.header);

    setImg(imgGiftGreen, ASSETS.gifts.green);
    setImg(imgGiftRed, ASSETS.gifts.red);
    setImg(imgGiftPink, ASSETS.gifts.pink);
    setImg(imgGiftOrange, ASSETS.gifts.orange);

    setImg(imgOpenGreen, ASSETS.openBtns.green);
    setImg(imgOpenRed, ASSETS.openBtns.red);
    setImg(imgOpenPink, ASSETS.openBtns.pink);
    setImg(imgOpenOrange, ASSETS.openBtns.orange);

    setImg(imgBack, ASSETS.back);
    setImg(imgClose, ASSETS.close);

    setImg(imgOpenSecretInModal, ASSETS.openSecret);
    setImg(imgOpenSecretFooter, ASSETS.openSecret);
    setImg(imgOkay, ASSETS.okay);

    render();
    showLanding();
  </script>
</body>
</html>
